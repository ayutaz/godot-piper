# GodotPiper 開発計画書

## 📊 技術調査結果サマリー

### プラットフォーム実現可能性評価

| プラットフォーム | 実現可能性 | 技術的課題 | 推奨度 | 実装フェーズ |
|------------|---------|--------|-------|-----------|
| **Windows** | ✅ 高 | なし | ⭐⭐⭐⭐⭐ | Phase 1 |
| **Linux** | ✅ 高 | なし | ⭐⭐⭐⭐⭐ | Phase 1 |
| **macOS** | ✅ 高 | Apple Silicon/Intel両対応必要 | ⭐⭐⭐⭐⭐ | Phase 1 |
| **Android** | ✅ 中 | NDKビルド、APKサイズ | ⭐⭐⭐⭐ | Phase 3 |
| **iOS** | ⚠️ 低 | App Store制限、動的ライブラリ制限 | ⭐⭐ | 検討中 |
| **Web** | ❌ 非推奨 | GDExtension WebAssembly制限 | ⭐ | Phase 4（代替案） |

### 技術スタック

- **コアエンジン**: piper-plus (C++)
- **音素化エンジン**: 
  - OpenJTalk (日本語)
  - eSpeak-NG (多言語)
- **推論エンジン**: ONNX Runtime
- **ビルドシステム**: SCons
- **統合方式**: GDExtension (Godot 4.3+)

## 🎯 開発フェーズ

### Phase 1: 基礎実装（1-2ヶ月）✅ 着手中

**目標**: デスクトップ版の最小限動作するTTSプラグイン

#### タスク一覧
- [x] プロジェクト初期設定
  - [x] GDExtensionテンプレート作成
  - [x] ディレクトリ構造設定
  - [x] 基本的なクラス定義
- [x] ビルドシステム構築
  - [x] SConstructファイル作成
  - [x] プラットフォーム別ビルドスクリプト
  - [x] godot-cpp統合
- [ ] piper-plus統合
  - [ ] 必要なソースファイルの移植
  - [ ] ONNX Runtime リンク
  - [ ] 基本的な音声合成実装
- [ ] テスト環境構築
  - [x] デモプロジェクト作成
  - [ ] 単体テスト追加
  - [ ] CI/CD設定（GitHub Actions）

#### 成果物
- Windows/Linux/macOS用バイナリ
- 基本的なデモプロジェクト
- ビルドドキュメント

### Phase 2: 機能拡張（2-3ヶ月）

**目標**: 実用的な機能を持つ完全なTTSプラグイン

#### タスク一覧
- [ ] 日本語対応
  - [ ] OpenJTalk統合
  - [ ] 日本語辞書ダウンロード機能
  - [ ] カスタム辞書機能実装
- [ ] 高度なAPI実装
  - [ ] 非同期音声生成
  - [ ] ストリーミング出力
  - [ ] 複数話者対応
  - [ ] 音声パラメータ調整
- [ ] パフォーマンス最適化
  - [ ] メモリプール実装
  - [ ] モデルキャッシング
  - [ ] マルチスレッド対応
- [ ] ドキュメント整備
  - [ ] APIリファレンス
  - [ ] チュートリアル
  - [ ] サンプルプロジェクト

#### 成果物
- 完全なGDScript API
- 日本語TTSデモ
- 包括的なドキュメント

### Phase 3: モバイル対応（2ヶ月）

**目標**: Android向け最適化されたビルド

#### タスク一覧
- [ ] Android NDKビルド設定
  - [ ] NDKツールチェーン設定
  - [ ] ARM64最適化
  - [ ] APKサイズ削減
- [ ] モバイル最適化
  - [ ] 軽量モデル対応
  - [ ] バッテリー消費最適化
  - [ ] メモリ使用量削減
- [ ] テストと検証
  - [ ] 実機テスト
  - [ ] パフォーマンステスト
  - [ ] 互換性テスト

#### 成果物
- Android APK
- モバイル最適化ガイド
- パフォーマンスレポート

### Phase 4: Web対応（代替実装）（1ヶ月）

**目標**: Godot HTML5エクスポートでの動作

#### アプローチ
GDExtensionのWebAssembly制限を回避するため、JavaScriptブリッジを実装

#### タスク一覧
- [ ] JavaScriptブリッジ設計
  - [ ] Godot JavaScript API調査
  - [ ] インターフェース設計
- [ ] Web実装
  - [ ] ONNX Runtime Web統合
  - [ ] OpenJTalk WebAssembly版統合
  - [ ] プログレッシブダウンロード
- [ ] デプロイメント
  - [ ] GitHub Pages対応
  - [ ] CDN設定
  - [ ] デモサイト構築

#### 成果物
- Webデモページ
- JavaScriptブリッジ
- デプロイメントガイド

## 📈 マイルストーン

| マイルストーン | 期限 | 状態 |
|-------------|------|------|
| M1: 基本動作確認 | 2週間 | 🚧 進行中 |
| M2: デスクトップ版リリース | 2ヶ月 | 📅 計画中 |
| M3: 日本語対応完了 | 4ヶ月 | 📅 計画中 |
| M4: Android版リリース | 6ヶ月 | 📅 計画中 |
| M5: Web版デモ公開 | 7ヶ月 | 📅 計画中 |

## 🔧 技術的詳細

### 依存ライブラリ

| ライブラリ | バージョン | 用途 | ライセンス |
|-----------|----------|------|-----------|
| ONNX Runtime | 1.18+ | 推論エンジン | MIT |
| OpenJTalk | 1.11+ | 日本語音素化 | Modified BSD |
| eSpeak-NG | 1.51+ | 多言語音素化 | GPL-3.0 |
| spdlog | 1.12+ | ロギング | MIT |
| nlohmann/json | 3.11+ | JSON処理 | MIT |

### ビルド要件

- **コンパイラ**
  - C++17対応必須
  - Windows: MSVC 2019+
  - Linux: GCC 9+
  - macOS: Clang 12+
  
- **ツール**
  - Python 3.8+
  - SCons 4.0+
  - CMake 3.15+（ONNX Runtimeビルド用）

### メモリ/パフォーマンス目標

- **初期化時間**: < 500ms
- **音声生成レイテンシ**: < 100ms（1文）
- **メモリ使用量**: < 200MB（モデル込み）
- **APKサイズ増加**: < 50MB

## 🚨 リスクと対策

### 技術的リスク

1. **WebAssembly制限**
   - リスク: GDExtensionがWebで完全サポートされない
   - 対策: JavaScriptブリッジによる代替実装

2. **iOS App Store制限**
   - リスク: 動的ライブラリが許可されない
   - 対策: 静的リンクまたはiOS対応を見送り

3. **モデルサイズ**
   - リスク: モバイルでAPKサイズが大きくなる
   - 対策: モデル圧縮、ダウンロード式配信

### スケジュールリスク

1. **piper-plus統合の複雑性**
   - リスク: 予想以上の移植作業
   - 対策: 段階的統合、最小限の機能から開始

2. **プラットフォーム固有の問題**
   - リスク: 各OSでの互換性問題
   - 対策: 早期のCI/CD構築、継続的テスト

## 📊 成功指標

- **技術指標**
  - [ ] 全主要プラットフォームでの動作
  - [ ] 5言語以上のサポート
  - [ ] 90%以上のテストカバレッジ

- **コミュニティ指標**
  - [ ] 100+ GitHub Stars
  - [ ] 10+ コントリビューター
  - [ ] Godot Asset Libraryへの登録

- **品質指標**
  - [ ] クラッシュ率 < 0.1%
  - [ ] ユーザー満足度 > 4.0/5.0
  - [ ] ドキュメント完成度 100%

## 🔄 更新履歴

- 2024-01-XX: 初版作成
- 2024-01-XX: Phase 1 開始

---

この計画は進捗に応じて定期的に更新されます。